<div class="chat-background d-flex flex-column justify-content-center align-items-center">
@if (!estaConectado())
{
    <app-chat-login 
        [mensaje]="chatService.mensaje"
        [error]="errorLogin()"
        (conectar)="conectarChat()">
    </app-chat-login>
}
@else 
{
    <section class="chat-container d-flex flex-column justify-content-center align-items-center p-2 gap-3 font-funnel-display">
        <main class="chat-text container-glass card p-0">
            <section class="chat-text-header card-header py-3">
                <h2>Chat grupal #1</h2>
                <button type="button"
                        class="close-chat-btn" 
                        aria-label="Cerrar chat"
                        (click)="desconectarChat()">
                    <span></span>
                    <span></span>
                </button>
            </section>
            <section class="chat-text-messages card-body d-flex flex-column gap-3">
            @for (mensaje of getMensajes(); track $index)
            {
                @if (mensaje.tipo == 'MESSAGE')
                {
                <article [class]="getNombreClienteActual() === mensaje.usuario ? 'message sent' : 'message received'">
                    <div class="bubble">
                        <span class="user">{{mensaje.usuario}}</span>
                        {{mensaje.mensaje}}
                        <span class="time">{{mensaje.fecha | date: 'short'}}</span>
                    </div>
                </article>
                }
                @else
                {
                    <div class="system-notification container-glass">
                        <p class="mb-0"><strong>{{mensaje.mensaje}}</strong> se ha unido al chat</p>
                    </div>
                }
            }
            @empty 
            {
                <p class="system-notification container-glass">Parece que nadie ha hablado aún...</p>
            }
            </section>

            @if (getUsuarioEscribiendo().trim() != '')
            {
                <p class="chat-text-writing"><strong>{{ getUsuarioEscribiendo() }}</strong> está escribiendo...</p>
            }
        </main>
        <section class="chat-msg-input w-100">
            <form (ngSubmit)="alEnviarMensaje()"
                  class="w-100 container-fluid">
                <div class="row">
                    <div class="col-9 p-0 pe-1">
                        <input type="text" 
                               name="texto"
                               id="texto" 
                               [(ngModel)]="getMensajeActual().mensaje"
                               (keyup)="alEscribir()"
                               class="container-glass w-100 chat-input"
                               placeholder="Escribe tu mensaje..."
                               aria-describedby="btn-enviar">
                    </div>
                    <div class="col-3 p-0 ps-1">
                        <button class="w-100 h-100 chat-btn"
                                type="submit" 
                                id="btn-enviar">Enviar</button>
                    </div>
                </div>
            </form>
        </section>
    </section>
}
</div>